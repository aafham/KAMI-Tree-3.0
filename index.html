<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>KAMI Tree 3.0 - Family Generation View</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="app" id="app">
    <header class="topbar" role="banner">
      <div class="topbar-left">
        <div class="brand">
          <div class="brand-title" id="familyName">Salasilah Keluarga</div>
          <div class="brand-subtitle" id="viewSubtitle">All Families</div>
        </div>
      </div>
      <div class="topbar-center">
        <div id="searchContainer" class="search search-inline" role="search">
          <input id="searchInput" type="search" placeholder="Search people..." aria-label="Search people" autocomplete="off" />
          <div id="searchResults" class="search-results" role="listbox" aria-label="Search results"></div>
        </div>
        <button class="icon-btn search-trigger" data-action="search-open" aria-label="Open search">Search</button>
        <div class="segmented" role="tablist" aria-label="View switch">
          <button id="forestModeBtn" class="seg-btn active" role="tab" aria-selected="true" data-view="forest">All Families</button>
          <button id="branchModeBtn" class="seg-btn" role="tab" aria-selected="false" data-view="branch">Branch</button>
          <button id="focusModeBtn" class="seg-btn" role="tab" aria-selected="false" data-view="focus">Focus</button>
        </div>
      </div>
      <div class="topbar-right">
        <button id="fitBtn" class="btn primary" data-action="fit">Fit</button>
        <button id="centerBtn" class="btn secondary" data-action="center">Center</button>
        <button id="resetBtn" class="btn secondary" data-action="reset">Reset</button>
        <div class="more">
          <button id="moreBtn" class="btn" data-action="more-toggle" aria-expanded="false" aria-haspopup="true">More...</button>
          <div id="moreMenu" class="menu" role="menu" aria-label="More menu" hidden>
            <div class="menu-group">
              <button class="menu-item" role="menuitem" data-action="export-toggle" aria-expanded="false">Export</button>
              <div id="exportMenu" class="submenu" hidden>
                <button class="menu-item" role="menuitem" data-action="export-png">Export PNG</button>
                <button class="menu-item" role="menuitem" data-action="export-pdf">Export PDF</button>
              </div>
            </div>
            <button class="menu-item" role="menuitem" data-action="help">Guide</button>
            <button class="menu-item" role="menuitem" data-action="settings">Settings</button>
          </div>
        </div>
      </div>
    </header>
    <div id="searchBackdrop" class="search-backdrop hidden" data-action="search-close"></div>

    <main class="workspace" role="main">
      <section class="canvas-area">
        <section id="focusView" class="view focus-view" aria-label="Focus view"></section>
        <section id="fullTreeView" class="view full-tree-view" aria-label="Tree view" hidden>
          <div class="full-tree-controls">
            <div class="breadcrumbs" id="breadcrumbs" aria-label="Breadcrumbs"></div>
            <div class="view-toggle-inline" role="tablist" aria-label="Map view toggle">
              <button id="treeViewBtn" class="btn active" role="tab" aria-selected="true" data-action="view-tree">Tree</button>
              <button id="timelineViewBtn" class="btn" role="tab" aria-selected="false" data-action="view-timeline">Timeline</button>
            </div>
            <div class="generation-controls" role="group" aria-label="Depth controls">
              <button class="btn" data-depth="all">All</button>
            </div>
            <div class="branch-controls">
              <button id="expandBranchBtn" class="btn" data-action="expand-branch">Expand branch</button>
              <button id="collapseBranchBtn" class="btn" data-action="collapse-branch">Collapse branch</button>
            </div>
            <button id="minimapToggle" class="btn" data-action="minimap">Minimap</button>
          </div>
          <div class="full-tree-canvas" id="fullTreeCanvas">
            <div class="tree-stage-outer">
              <div class="tree-stage" id="treeStage" aria-live="polite"></div>
            </div>
          </div>
          <div id="timelinePanel" class="timeline-panel" hidden>
            <div id="timelineList" class="timeline-list"></div>
          </div>
          <div id="minimap" class="minimap" hidden>
            <div class="minimap-header">Minimap</div>
            <div class="minimap-body">
              <div id="minimapContent" class="minimap-content"></div>
              <div id="minimapViewport" class="minimap-viewport"></div>
            </div>
          </div>
        </section>
      </section>
      <aside class="inspector" id="inspector" aria-label="Inspector panel">
        <div class="inspector-header">
          <div class="inspector-title">Inspector</div>
          <button id="inspectorToggle" class="btn secondary" data-action="inspector-toggle">Collapse</button>
        </div>
        <div id="detailDrawer" class="drawer inspector-drawer" role="region" aria-label="Person details" aria-hidden="true">
          <div class="drawer-header">
            <div id="drawerTitle" class="drawer-title">Person</div>
            <button id="drawerClose" class="btn" data-action="drawer-close">Clear</button>
          </div>
          <div id="drawerContent" class="drawer-content"></div>
          <div class="drawer-footer">
            <button id="drawerGoTo" class="btn" data-action="drawer-center">Go to / Center here</button>
            <button id="drawerFocus" class="btn" data-action="drawer-focus">Focus this person</button>
          </div>
        </div>
        <section id="insights" class="insights panel" aria-label="Insights panel">
          <button id="insightsToggle" class="insights-toggle btn" aria-expanded="true">Insights</button>
          <div class="insights-content" id="insightsContent">
            <div class="stat">
              <div class="stat-label">People</div>
              <div class="stat-value" id="statPeople">0</div>
            </div>
            <div class="stat">
              <div class="stat-label">Families</div>
              <div class="stat-value" id="statFamilies">0</div>
            </div>
            <div class="stat">
              <div class="stat-label">Descendant depth</div>
              <div class="stat-value" id="statGenerations">0</div>
            </div>
          </div>
        </section>
      </aside>
    </main>

    <div id="legend" class="legend" aria-label="Legend">
      <span class="legend-item"><span class="dot dot-male"></span>Male</span>
      <span class="legend-item"><span class="dot dot-female"></span>Female</span>
      <span class="legend-item"><span class="dot dot-unknown"></span>Unknown</span>
    </div>

    <div id="settingsModal" class="modal" aria-hidden="true" role="dialog" aria-modal="true">
      <div class="modal-card">
        <div class="modal-header">
          <div class="modal-title">Settings</div>
          <button class="btn" data-action="settings-close">Close</button>
        </div>
        <div class="modal-body settings-list">
          <label class="toggle-row">
            <span class="toggle-text">Show years</span>
            <input type="checkbox" id="settingShowYears" checked />
          </label>
          <label class="toggle-row">
            <span class="toggle-text">Compact cards</span>
            <input type="checkbox" id="settingCompactCards" />
          </label>
          <label class="toggle-row">
            <span class="toggle-text">Show gender badge</span>
            <input type="checkbox" id="settingShowGender" checked />
          </label>
          <label class="toggle-row">
            <span class="toggle-text">Reduce motion</span>
            <input type="checkbox" id="settingReduceMotion" />
          </label>
          <label class="toggle-row">
            <span class="toggle-text">Show deceased</span>
            <input type="checkbox" id="settingShowDeceased" checked />
          </label>
          <label class="toggle-row">
            <span class="toggle-text">Show only direct line (Branch)</span>
            <input type="checkbox" id="settingDirectLine" />
          </label>
          <div class="setting-row">
            <span>Default view</span>
            <select id="settingDefaultView">
              <option value="forest">All Families</option>
              <option value="branch">Branch</option>
              <option value="focus">Focus</option>
            </select>
          </div>
        </div>
      </div>
    </div>

    <div id="helpModal" class="modal" aria-hidden="true" role="dialog" aria-modal="true">
      <div class="modal-card">
        <div class="modal-header">
          <div class="modal-title">How to Use</div>
          <button class="btn" data-action="help-close">Close</button>
        </div>
        <div class="modal-body">
          <div class="help-title">Views</div>
          <ul class="help-list">
            <li><strong>All Families</strong>: shows all root families in one canvas.</li>
            <li><strong>Branch</strong>: focuses on one family branch (selected root).</li>
            <li><strong>Focus</strong>: one person with parents/spouses/children.</li>
            <li><strong>Tree / Timeline</strong>: switch map view between tree and timeline list.</li>
          </ul>
          <div class="help-title">Navigation</div>
          <ul class="help-list">
            <li>Click a card to open details.</li>
            <li>Use <strong>Focus this person</strong> in the drawer to open Branch view.</li>
            <li>Search jumps to the person and highlights the path.</li>
            <li>Drag to pan, scroll to zoom (Forest & Branch).</li>
            <li><strong>Fit</strong> zooms to all visible nodes.</li>
            <li>Use <strong>Tree</strong> or <strong>Timeline</strong> buttons in the map.</li>
          </ul>
          <div class="help-title">Shortcuts</div>
          <ul class="help-list">
            <li><code>/</code> focus search</li>
            <li><code>C</code> center selected</li>
            <li><code>Esc</code> close drawer/modals</li>
          </ul>
        </div>
      </div>
    </div>

  </div>

  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="app.js"></script>
</body>
</html>
